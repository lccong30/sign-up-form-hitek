<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form - Register</title>
    <link rel="stylesheet" href="./style.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700&family=Raleway:wght@400;600;700;800&display=swap"
        rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
</head>

<body>
    <div id="#contactus" class="contact">
        <div class="container">
            <div class="contact-main">
                <div class="contact-heading">
                    <h2>
                        LIÊN HỆ <strong class="">TƯ VẤN</strong>
                    </h2>
                    <p class="font-semibold uppercase">
                        Tối ưu hóa tài nguyên và tối đa hóa sự hiệu quả của bạn.
                    </p>
                </div>
                <form class="contact-form">
                    <div class="contact__form-group">
                        <input required type="text" placeholder="Tên của bạn"
                            class="contact-input contact-input-name" />
                        <span class="error-msg error-msg-name"></span>
                    </div>
                    <div class="contact__form-group">
                        <input required type="text" placeholder="abc@gmail.com"
                            class="contact-input contact-input-email" />
                        <span class="error-msg error-msg-email"></span>
                    </div>
                    <div class="contact__form-group">
                        <input required type="number" placeholder="Nhập số điện thoại"
                            class="contact-input contact-input-phone" />
                        <span class="error-msg error-msg-phone"></span>
                    </div>
                    <textarea class="contact-area contact-field contact-input-note" placeholder="Để lại lời nhắn"
                        minLength="50"></textarea>
                    <input type="submit" value="Gửi" id="sumit-form"
                        class="font-semibold text-[#363636] btn btn-contact" />
                </form>
            </div>
        </div>
    </div>
    <!-- Notification -->
    <div id="notify" class="notify">
        <div class="notify__container"><span>!</span> Đăng ký thành công</div>
    </div>

    <!-- Jquery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.3.4/axios.min.js"
        integrity="sha512-LUKzDoJKOLqnxGWWIBM4lzRBlxcva2ZTztO8bTcWPmDSpkErWx0bSP4pdsjNH8kiHAUPaT06UXcb+vOEZH+HpQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <!-- Toastify -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastify-js/1.6.1/toastify.js"
        integrity="sha512-MnKz2SbnWiXJ/e0lSfSzjaz9JjJXQNb2iykcZkEY2WOzgJIWVqJBFIIPidlCjak0iTH2bt2u1fHQ4pvKvBYy6Q=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script>
        const listInput = document.querySelectorAll('.contact-input')
        const contactForm = document.querySelector('.contact-form')

        function showError(input, msg) {
            input.parentElement.querySelector('span').innerHTML = msg || 'Không hợp lệ'
        }

        // Handle when input validate
        function isValidateInput(input) {
            input.parentElement.querySelector('span').innerHTML = ""
        }

        //Check empty input
        function checkInput() {
            let isError = false;
            listInput.forEach(input => {
                input.value = input.value.trim()
                if (!input.value) {
                    isError = true;
                    showError(input, 'Không được để trống!')
                } else {
                    isValidateInput(input)
                }
            })
            return isError
        }

        function validateEmail(input) {
            let isError = false
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (input.value === '') {
                showError(input, 'Không được để trống!')
            } else if (!re.test(input.value)) {
                isError = true
                showError(input, 'Email không hợp lệ!')
            } else {
                isValidateInput(input)
            }
            return isError
        }

        // Reset input after submit
        const handleReset = () => {
            listInput.forEach(inp => {
                inp.value = ""
            })
        }

        const handleNotify = (msg, warning) => {
            const a = document.querySelector('.notify__container')
            const tosify = document.querySelector('#notify')

            tosify.classList.remove('active')
            tosify.classList.remove('hidden')
            tosify.classList.remove('warning')

            a.innerHTML = msg
            warning ? tosify.classList.add('active', "warning") : tosify.classList.add('active')

            setTimeout(() => {
                tosify.classList.add('hidden')
            }, 2000)



        }

        const handleSubmit = async (e) => {
            e.preventDefault()

            const input_name = document.querySelector('.contact-input-name')
            const input_phone = document.querySelector('.contact-input-phone')
            const input_email = document.querySelector('.contact-input-email')
            const input_note = document.querySelector('.contact-input-note')
            const tosify = document.querySelector('#notify')

            let isEmpty = checkInput()
            let isEmailInValid = validateEmail(input_email)
            if (!isEmpty && !isEmailInValid) {
                const payload = {
                    name: input_name.value,
                    phone: input_phone.value,
                    email: input_email.value,
                    note: input_note.value,
                }
                await axios.post('https://server-subscriber-hitek.vercel.app/api/pms/subscribe', payload)
                    .then(async function (response) {
                        await console.log(response);
                        handleReset()
                        handleNotify(response.data.msg, false)
                    })
                    .catch(function (error) {
                        console.log('catch')
                        console.log(error);
                        handleNotify(error.response.data, true)

                    });
            } else {
                console.log('Chua nhap du thong tin')

            }
        }

        document.getElementById('sumit-form').addEventListener('click', handleSubmit)
    </script>
</body>

</html>